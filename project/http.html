<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP/0.9 | jasonpink&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blogs/favicon.ico">
    <script>(function(h,o,t,j,a,r){
                h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
                h._hjSettings={hjid:1650620,hjsv:6};
                a=o.getElementsByTagName('head')[0];
                r=o.createElement('script');r.async=1;
                r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
                a.appendChild(r);
            })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');</script>
    <meta name="description" content="">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    
    <link rel="preload" href="/blogs/assets/css/0.styles.f48c9532.css" as="style"><link rel="preload" href="/blogs/assets/js/app.d6da1c5f.js" as="script"><link rel="preload" href="/blogs/assets/js/6.b1c09f51.js" as="script"><link rel="preload" href="/blogs/assets/js/1.f49fca97.js" as="script"><link rel="preload" href="/blogs/assets/js/17.96d30e1e.js" as="script"><link rel="prefetch" href="/blogs/assets/js/10.1caeef65.js"><link rel="prefetch" href="/blogs/assets/js/11.9684e612.js"><link rel="prefetch" href="/blogs/assets/js/12.652283bc.js"><link rel="prefetch" href="/blogs/assets/js/13.23717e8d.js"><link rel="prefetch" href="/blogs/assets/js/14.502c8ebe.js"><link rel="prefetch" href="/blogs/assets/js/15.73b0f3ca.js"><link rel="prefetch" href="/blogs/assets/js/16.28fb8d21.js"><link rel="prefetch" href="/blogs/assets/js/18.d08d1299.js"><link rel="prefetch" href="/blogs/assets/js/19.135a28aa.js"><link rel="prefetch" href="/blogs/assets/js/2.32dd7b9e.js"><link rel="prefetch" href="/blogs/assets/js/20.4db65339.js"><link rel="prefetch" href="/blogs/assets/js/21.33c6accf.js"><link rel="prefetch" href="/blogs/assets/js/22.c5844ee4.js"><link rel="prefetch" href="/blogs/assets/js/23.e45b7b3c.js"><link rel="prefetch" href="/blogs/assets/js/24.38316e94.js"><link rel="prefetch" href="/blogs/assets/js/25.5d8923b7.js"><link rel="prefetch" href="/blogs/assets/js/26.8c94239f.js"><link rel="prefetch" href="/blogs/assets/js/27.bdc48b62.js"><link rel="prefetch" href="/blogs/assets/js/28.d696023b.js"><link rel="prefetch" href="/blogs/assets/js/29.5af9e068.js"><link rel="prefetch" href="/blogs/assets/js/30.21db81c7.js"><link rel="prefetch" href="/blogs/assets/js/31.91794a33.js"><link rel="prefetch" href="/blogs/assets/js/32.431f50e3.js"><link rel="prefetch" href="/blogs/assets/js/33.42d8deb9.js"><link rel="prefetch" href="/blogs/assets/js/34.bf85ef65.js"><link rel="prefetch" href="/blogs/assets/js/35.2c3371d6.js"><link rel="prefetch" href="/blogs/assets/js/36.58fd4836.js"><link rel="prefetch" href="/blogs/assets/js/37.802914e6.js"><link rel="prefetch" href="/blogs/assets/js/38.84489525.js"><link rel="prefetch" href="/blogs/assets/js/39.d219fd7b.js"><link rel="prefetch" href="/blogs/assets/js/40.95fbe5e8.js"><link rel="prefetch" href="/blogs/assets/js/41.0e6cae84.js"><link rel="prefetch" href="/blogs/assets/js/42.037f9d3f.js"><link rel="prefetch" href="/blogs/assets/js/43.3cccb481.js"><link rel="prefetch" href="/blogs/assets/js/44.34b06605.js"><link rel="prefetch" href="/blogs/assets/js/45.70d0d91d.js"><link rel="prefetch" href="/blogs/assets/js/46.99340343.js"><link rel="prefetch" href="/blogs/assets/js/47.7dd51c87.js"><link rel="prefetch" href="/blogs/assets/js/48.e7ca951d.js"><link rel="prefetch" href="/blogs/assets/js/49.00a45625.js"><link rel="prefetch" href="/blogs/assets/js/50.05ccf665.js"><link rel="prefetch" href="/blogs/assets/js/51.c0ce1543.js"><link rel="prefetch" href="/blogs/assets/js/52.2450d87c.js"><link rel="prefetch" href="/blogs/assets/js/53.6a957d36.js"><link rel="prefetch" href="/blogs/assets/js/54.8dbdf14d.js"><link rel="prefetch" href="/blogs/assets/js/55.129060b6.js"><link rel="prefetch" href="/blogs/assets/js/56.a1c2f9e7.js"><link rel="prefetch" href="/blogs/assets/js/57.85804ec7.js"><link rel="prefetch" href="/blogs/assets/js/58.fbf43daa.js"><link rel="prefetch" href="/blogs/assets/js/59.2018d50b.js"><link rel="prefetch" href="/blogs/assets/js/60.5b8cc1be.js"><link rel="prefetch" href="/blogs/assets/js/61.4a89c358.js"><link rel="prefetch" href="/blogs/assets/js/62.7a1d82a5.js"><link rel="prefetch" href="/blogs/assets/js/63.b83bf69d.js"><link rel="prefetch" href="/blogs/assets/js/64.0d8cd8a3.js"><link rel="prefetch" href="/blogs/assets/js/65.d571c93e.js"><link rel="prefetch" href="/blogs/assets/js/66.0d3e533c.js"><link rel="prefetch" href="/blogs/assets/js/67.1482640b.js"><link rel="prefetch" href="/blogs/assets/js/68.0f33db31.js"><link rel="prefetch" href="/blogs/assets/js/69.df3f0209.js"><link rel="prefetch" href="/blogs/assets/js/7.b142b0a0.js"><link rel="prefetch" href="/blogs/assets/js/70.a896fe20.js"><link rel="prefetch" href="/blogs/assets/js/71.0a2d430f.js"><link rel="prefetch" href="/blogs/assets/js/72.2a2def77.js"><link rel="prefetch" href="/blogs/assets/js/73.2c7b864f.js"><link rel="prefetch" href="/blogs/assets/js/74.39bb40c1.js"><link rel="prefetch" href="/blogs/assets/js/75.9cbab71e.js"><link rel="prefetch" href="/blogs/assets/js/76.966bb8b5.js"><link rel="prefetch" href="/blogs/assets/js/77.52793130.js"><link rel="prefetch" href="/blogs/assets/js/78.df39a7f2.js"><link rel="prefetch" href="/blogs/assets/js/79.13c68a69.js"><link rel="prefetch" href="/blogs/assets/js/8.9295f804.js"><link rel="prefetch" href="/blogs/assets/js/80.10c3ca9c.js"><link rel="prefetch" href="/blogs/assets/js/81.0e1d3060.js"><link rel="prefetch" href="/blogs/assets/js/82.f75fdbe4.js"><link rel="prefetch" href="/blogs/assets/js/83.5e440d51.js"><link rel="prefetch" href="/blogs/assets/js/9.f2ef6c8d.js"><link rel="prefetch" href="/blogs/assets/js/vendors~docsearch.9a20207f.js"><link rel="prefetch" href="/blogs/assets/js/vendors~flowchart.e9b116c9.js">
    <link rel="stylesheet" href="/blogs/assets/css/0.styles.f48c9532.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar shadow"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="con-btns-header"><a href="/blogs/" class="home-link router-link-active"><!----> <span class="site-name">jasonpink's blog</span></a> <div class="links linksColor"><!----></div></div> <div class="con-redes-download"><!----></div></header> <div class="sidebar-map"><div class="c-sidebar-map"><ul class="sidebar-links-map"><li><div class="sidebar-group first collapsable"><ul class="sidebar-group-items"><li><a href="/blogs/project/http.html" aria-current="page" class="active sidebar-link">http协议</a></li><li><a href="/blogs/project/performance.html" class="sidebar-link">前端性能优化</a></li><li><a href="/blogs/project/qiankun.html" class="sidebar-link">微前端实践</a></li><li><a href="/blogs/project/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/blogs/project/IntersectionObserver.html" class="sidebar-link">IntersectionObserver</a></li></ul></div></li></ul> </div> <div class="con-carbon-noti"></div></div> <div class="sidebar-mask"></div> <div class="sidebar"><div class="c-sidebar"> <div class="search-box"><input aria-label="Search" placeholder="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----> <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>开发规范</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/team/git.html" class="sidebar-link">Git规范</a></li><li><a href="/blogs/team/vue.html" class="sidebar-link">Vue规范</a></li><li><a href="/blogs/team/eslint-prettier.html" class="sidebar-link">Eslint+Prettier</a></li><li><a href="/blogs/team/js-style-guide.html" class="sidebar-link">Javascript风格指南</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Project</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/project/http.html" aria-current="page" class="active sidebar-link">http协议</a></li><li><a href="/blogs/project/performance.html" class="sidebar-link">前端性能优化</a></li><li><a href="/blogs/project/qiankun.html" class="sidebar-link">微前端实践</a></li><li><a href="/blogs/project/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/blogs/project/IntersectionObserver.html" class="sidebar-link">IntersectionObserver</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>CSS</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/css/bfc.html" class="sidebar-link">BFC</a></li><li><a href="/blogs/css/flex-left-end.html" class="sidebar-link">flex布局最后一行左对齐方案</a></li><li><a href="/blogs/css/stacking-context.html" class="sidebar-link">层叠上下文</a></li><li><a href="/blogs/css/block.html" class="sidebar-link">你不知道的包含块</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>JS</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/javascript/0.1+0.2.html" class="sidebar-link">0.1+0.2 !== 0.3</a></li><li><a href="/blogs/javascript/async-defer.html" class="sidebar-link">async与defer</a></li><li><a href="/blogs/javascript/commonjs.html" class="sidebar-link">Commonjs</a></li><li><a href="/blogs/javascript/Promise.html" class="sidebar-link">Promise</a></li><li><a href="/blogs/javascript/inherit.html" class="sidebar-link">JavaScript中的继承</a></li><li><a href="/blogs/javascript/context.html" class="sidebar-link">JavaScript中的执行上下文</a></li><li><a href="/blogs/javascript/ES6解构的本质.html" class="sidebar-link">ES6解构的本质</a></li><li><a href="/blogs/javascript/debounce.html" class="sidebar-link">防抖与节流</a></li><li><a href="/blogs/javascript/for...in与for...of.html" class="sidebar-link">for...in与for...of</a></li><li><a href="/blogs/javascript/hash与history模式.html" class="sidebar-link">hash与history模式</a></li><li><a href="/blogs/javascript/eventloop.html" class="sidebar-link">事件循环机制</a></li><li><a href="/blogs/javascript/url.html" class="sidebar-link">输入url发生了什么</a></li><li><a href="/blogs/javascript/browser.html" class="sidebar-link">浏览器如何渲染页面</a></li><li><a href="/blogs/javascript/cache.html" class="sidebar-link">浏览器缓存机制</a></li><li><a href="/blogs/javascript/use-code.html" class="sidebar-link">常用代码片段</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>前端工程化</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/engineer/deploy.html" class="sidebar-link">node发布脚本</a></li><li><a href="/blogs/engineer/action.html" class="sidebar-link">github aciton</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Vue</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/vue/reactive.html" class="sidebar-link">响应式原理</a></li><li><a href="/blogs/vue/diff.html" class="sidebar-link">diff算法解析</a></li><li><a href="/blogs/vue/v-model.html" class="sidebar-link">v-model原理</a></li><li><a href="/blogs/vue/nextTick.html" class="sidebar-link">nextTick原理</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>React</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/react/ref.html" class="sidebar-link">ref</a></li><li><a href="/blogs/react/useCallback与useMemo.html" class="sidebar-link">useCallback</a></li><li><a href="/blogs/react/高阶组件HOC.html" class="sidebar-link">高阶组件HOC</a></li><li><a href="/blogs/react/1.html" class="sidebar-link">常见问题</a></li><li><a href="/blogs/react/redux.html" class="sidebar-link">Redux</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>读书笔记</span></p> <ul class="sidebar-group-items"><li><a href="/blogs/booknote/CSS揭秘.html" class="sidebar-link">《CSS揭秘》</a></li><li><a href="/blogs/booknote/CSS世界.html" class="sidebar-link">《CSS世界》</a></li></ul></div></li></ul> </div></div> <!----> <!----> <div class="page"><div class="content-pagex content content__default"><h2 id="http-0-9"><a href="#http-0-9" class="header-anchor">#</a> HTTP/0.9</h2> <blockquote><p>HTTP/0.9 是于 1991 年提出的，需求很简单————用来在网络之间传递 HTML 超文本的内容，所以被称为<strong>超文本传输协议</strong>。基于请求响应的模式，从客户端发出请求，服务端返回数据。</p></blockquote> <h3 id="一个完整的请求流程"><a href="#一个完整的请求流程" class="header-anchor">#</a> 一个完整的请求流程</h3> <ul><li>建立 TCP 连接，因为 HTTP 都是基于 TCP 协议的，所以客户端先要根据 IP 地址，端口号和服务器建立 TCP 连接，三次握手的过程</li> <li>建立好连接后，会发送一个 GET 请求行的信息，如 GET/index.html 用来获取 index.html</li> <li>服务器接收请求信息后，读取对应的 HTML 文件，并将数据以 ASCII 字符流返回给客户端</li> <li>HTML 文档传输完成，断开连接
<img src="/blogs/assets/img/http09.db1166c6.png" alt="事件循环" title="HTTP0.9"></li></ul> <h3 id="有以下三个特点"><a href="#有以下三个特点" class="header-anchor">#</a> 有以下三个特点</h3> <ul><li>只有一个请求行，没有 HTTP 请求头和请求体，因为只需要一个请求行就可以完整的表达客户端的需求了</li> <li>服务器也没有返回头信息，因为服务器并不需要告诉客户端太多信息，只需要返回数据就可以了</li> <li>返回的文件内容是以 ASCII 字符流来传输的,因为都是 HTML 格式的文件，所以使用 ASCII 字节码来传输是最合适的。</li></ul> <hr> <h2 id="http-1-0"><a href="#http-1-0" class="header-anchor">#</a> HTTP/1.0</h2> <p>随着万维网的不断发展，带来了很多新的需求，而 HTTP/0.9 已经不能适用新兴网络的发展，所以这时就需要一个新的协议来支撑新兴网络，这就是 HTTP/1.0 诞生的原因</p> <p>首先浏览器中展示的不单是 HTML 文件了，还包括了 JavaScript、CSS、图片、音频、视频等不同类型的文件，因此<strong>支持多种类型的文件下载是 HTTP/1.0 的一个核心诉求</strong></p> <p>HTTP/1.0 引入了请求头和响应头，它们都是以 key-value 形式保存的，在 HTTP 发送请求时，会带上请求头信息，服务器返回数据时，会返回响应头信息。</p> <p><img src="/blogs/assets/img/http10.b52b0d1a.png" alt="事件循环" title="HTTP1.0"></p> <h3 id="http-1-0-怎么通过请求头和响应头来支持多种不同类型的数据"><a href="#http-1-0-怎么通过请求头和响应头来支持多种不同类型的数据" class="header-anchor">#</a> HTTP/1.0 怎么通过请求头和响应头来支持多种不同类型的数据</h3> <ul><li><p>首先，浏览器需要知道服务器返回的数据是什么类型，然后浏览器才能根据不同的数据类型做针对性的处理</p></li> <li><p>其次，为了减轻出书性能，服务器会对数据进行压缩后再传输，所以浏览器需要知道服务器压缩的方法</p></li> <li><p>再次，由于万维网是全球性的，所以需要提供国际化支持，服务器需要对不同的地区提供不同的语言版本</p></li> <li><p>最后，由于增加了各种不同类型的文件，而每种文件的编码形式又可能不一样，为了能够准确地读取文件，浏览器需要知道文件的编码类型</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>accept: text/html //期望返回html类型的文件
accept-encoding: gzip, deflate, br //期望服务器采用gzip、deflate或br其中的一种压缩方式
accept-Charset: ISO-8859-1,utf-8 //期望返回的文件编码是utf-8或ISO-8859-1
accept-language: zh-CN,zh //期望页面的优先语言是中文
</code></pre></div><h3 id="除了对多文件提供良好的支持外-还引入了很多其它特性"><a href="#除了对多文件提供良好的支持外-还引入了很多其它特性" class="header-anchor">#</a> 除了对多文件提供良好的支持外，还引入了很多其它特性</h3> <ul><li><p>有的请求服务器可能无法处理，或者处理出错，这时候就需要告诉浏览器最终的处理情况，这就引入了状态码，状态码是通过响应行的方式来通知浏览器的</p> <ul><li>2XX 成功
<ul><li>200 OK:表示从客户端发来的请求在服务器端被正确处理</li> <li>204 No content: 表示请求成功，但响应报文不含实体的主体部分</li> <li>206 Partial Content: 进行范围请求</li></ul></li> <li>3XX 重定向
<ul><li>301 moved permanently: 永久性重定向，表示资源已被分配了新的 URL</li> <li>302 found，临时性重定向，表示资源临时被分配了新的 URL</li> <li>303 see other，表示资源存在着另一个 URL，应使用 GET 方法定向获取资源</li> <li>304 not modified，表示服务器允许访问资源，但因发生请求未满足条件的情况</li> <li>307 temporary redirect，临时重定向，和 302 含义相同</li></ul></li> <li>4XX 客户端错误
<ul><li>400 bad request，请求报文存在语法错误</li> <li>401 unauthorized，表示发送的请求需要有通过 HTTP 认证的认证信息</li> <li>403 forbidden，表示对请求资源的访问被服务器拒绝</li> <li>404 not found，表示在服务器上没有找到请求的资源</li></ul></li> <li>5XX 服务器错误
<ul><li>500 internal sever error，表示服务器端在执行请求时发生了错误</li> <li>503 service unavailable，表明服务器暂时处于超负载或正在停机维护，无法处理请求</li></ul></li></ul></li> <li><p>为了减轻服务器的压力，在 HTTP/1.0 中提供了 Cache 机制</p></li> <li><p>服务器需要统计客户端的基础信息，比如 Windows 和 macOS 的用户数量分别是多少，所以 HTTP/1.0 的请求头中还加入了用户代理的字段。</p></li></ul> <hr> <h2 id="http-1-1"><a href="#http-1-1" class="header-anchor">#</a> HTTP/1.1</h2> <blockquote><p>不过随着技术的继续发展，需求也在不断迭代更新，很快 HTTP/1.0 也不能满足需求了，所以 HTTP/1.1 又在 HTTP/1.0 的基础之上做了大量的更新。接下来我们来看看 HTTP/1.0 遇到了哪些主要的问题，以及 HTTP/1.1 又是如何改进的。</p></blockquote> <h3 id="_1-改进持久连接"><a href="#_1-改进持久连接" class="header-anchor">#</a> 1.改进持久连接</h3> <p>HTTP/1.0 每进行一次 HTTP 通信，都需要经历建立 TCP 连接、传输 HTTP 数据和断开 TCP 连接三个阶段。为了解决这个问题，HTTP/1.1 中增加了持久连接的方法，它的特点是在一个 TCP 上可以传输多个 HTTP 请求，只要浏览器或服务器没有明确的断开连接，那么该 TCP 连接会一直保持。</p> <p>持久连接在 HTTP/1.1 中是默认开启的，所以你不需要专门为了持久连接去 HTTP 请求头设置信息，如果你不想要采用持久连接，可以在 HTTP 请求头中加上 Connection: close。<strong>目前浏览器中对于同一个域名，默认允许同时建立 6 个 TCP 持久连接。</strong></p> <h3 id="_2-不成熟的-http-管线化"><a href="#_2-不成熟的-http-管线化" class="header-anchor">#</a> 2.不成熟的 HTTP 管线化</h3> <p>持久连接虽然能减少 TCP 的建立和连接次数，但是它需要等待前面的请求返回后，才能进行下一次请求。如果 TCP 通道中的某个请求没有及时返回，那么就会阻塞后面的所有请求，这就是著名的<strong>对头阻塞</strong>的问题。</p> <h3 id="_3-提供虚拟主机的支持"><a href="#_3-提供虚拟主机的支持" class="header-anchor">#</a> 3.提供虚拟主机的支持</h3> <p>在 HTTP/1.0 中，每个域名绑定了一个唯一的 IP 地址，因此一个服务器只能支持一个域名。但是随着虚拟主机技术的发展，需要实现在一台物理主机上绑定多个虚拟主机，每个虚拟主机都有自己的单独的域名，这些单独的域名都公用同一个 IP 地址。</p> <p>因此，HTTP/1.1 的请求头中增加了<strong>Host</strong>字段，用来表示当前的域名地址，这样服务器就可以根据不同的 Host 值做不同的处理。</p> <h3 id="_4-对动态生成的内容提供了完美支持"><a href="#_4-对动态生成的内容提供了完美支持" class="header-anchor">#</a> 4.对动态生成的内容提供了完美支持</h3> <h3 id="_5-客户端-cookie、安全机制"><a href="#_5-客户端-cookie、安全机制" class="header-anchor">#</a> 5.客户端 Cookie、安全机制</h3> <hr> <h2 id="http-2-0"><a href="#http-2-0" class="header-anchor">#</a> HTTP/2.0</h2> <h3 id="http-1-1-的主要问题-对带宽的利用率不理想"><a href="#http-1-1-的主要问题-对带宽的利用率不理想" class="header-anchor">#</a> HTTP/1.1 的主要问题：对带宽的利用率不理想</h3> <p>主要由以下三个原因导致：</p> <ol><li><p>TCP 的慢启动</p></li> <li><p>同时开启了多条 TCP 连接,这些连接会竞争固定的带宽</p></li> <li><p>HTTP/1.1 对头阻塞问题</p></li></ol> <hr> <h3 id="为了解决以上问题-引入-http-2-协议-一个域名只使用一个-tcp-长连接和消除对头阻塞问题"><a href="#为了解决以上问题-引入-http-2-协议-一个域名只使用一个-tcp-长连接和消除对头阻塞问题" class="header-anchor">#</a> 为了解决以上问题，引入 HTTP/2 协议：一个域名只使用一个 TCP 长连接和消除对头阻塞问题</h3> <p><img src="/blogs/assets/img/http2.ff9558fd.jpg" alt="HTTP/2 的多路复用" title="HTTP/2 的多路复用">
该图就是 HTTP/2 最核心、最重要且最具颠覆性的<strong>多路复用机制</strong>。从图中你会发现每个请求都有一个对应的 ID，如 stream1 表示 index.html 的请求，stream2 表示 foo.css 的请求。这样在浏览器端，就可以随时将请求发送给服务器了。</p> <p>服务器端接收到这些请求后，会根据自己的喜好来决定优先返回哪些内容，比如服务器可能早就缓存好了 index.html 和 bar.js 的响应头信息，那么当接收到请求的时候就可以立即把 index.html 和 bar.js 的响应头信息返回给浏览器，然后再将 index.html 和 bar.js 的响应体数据返回给浏览器。之所以可以随意发送，是因为每份数据都有对应的 ID，浏览器接收到之后，会筛选出相同 ID 的内容，将其拼接为完整的 HTTP 响应数据。</p> <p>HTTP/2 使用了多路复用技术，可以将请求分成一帧一帧的数据去传输，这样带来了一个额外的好处，就是当收到一个优先级高的请求时，比如接收到 JavaScript 或者 CSS 关键资源的请求，服务器可以暂停之前的请求来优先处理关键资源的请求。</p> <hr> <h3 id="多路复用的实现"><a href="#多路复用的实现" class="header-anchor">#</a> 多路复用的实现</h3> <p><img src="/blogs/assets/img/http22.86cdf01a.png" alt="HTTP/2 协议栈" title="HTTP/2 协议栈"></p> <ul><li><p>首先，浏览器准备好请求数据，包括了请求行、请求头等信息，如果是 POST 方法，那么还要有请求体。</p></li> <li><p>这些数据经过二进制分帧层处理之后，会被转换为一个个带有请求 ID 编号的帧，通过协议栈将这些帧发送给服务器。</p></li> <li><p>服务器接收到所有帧之后，会将所有相同 ID 的帧合并为一条完整的请求信息。</p></li> <li><p>然后服务器处理该条请求，并将处理的响应行、响应头和响应体分别发送至二进制分帧层。</p></li> <li><p>同样，二进制分帧层会将这些响应数据转换为一个个带有请求 ID 编号的帧，经过协议栈发送给浏览器。</p></li> <li><p>浏览器接收到响应帧之后，会根据 ID 编号将帧的数据提交给对应的请求。</p></li></ul> <hr> <h3 id="http-2-其他特性"><a href="#http-2-其他特性" class="header-anchor">#</a> HTTP/2 其他特性</h3> <ol><li><p>可以设置请求的优先级</p></li> <li><p>服务器推送</p></li> <li><p>头部压缩</p></li></ol> <h2 id="tcp-协议"><a href="#tcp-协议" class="header-anchor">#</a> TCP 协议</h2> <h3 id="三次握手建立连接"><a href="#三次握手建立连接" class="header-anchor">#</a> 三次握手建立连接</h3> <blockquote><p>TCP 是面向连接的，无论哪一方向另一方发送数据之前，都必须先在双方之间建立一条连接。在 TCP/IP 协议中，TCP 协议提供可靠的连接服务，连接通过三次握手进行初始化。三次握手的目的是同步连接双方的序列号和确认号并交换 TCP 窗口大小信息。TCP 连接是全双工的，数据在两个方向上能同时传递。</p></blockquote> <ul><li><p>第一次握手：建立连接，客户端发送连接请求报文段，将 SYN 置为 1，Sequence Number 置为 X。然后客户端进入 SYN_SEND 状态，等待服务器的确认</p></li> <li><p>第二次握手：服务器收到客户端的 SYN 报文段，需要对这个 SYN 报文段进行确认，设置 ACK(Acknowledgment Number)为 X+1;同时自己还要发送 SYN 请求信息，将 SYN 置为 1，Sequence Number 置为 Y;服务器将上述所有信息放到一个报文段中，一并发送给客户端，此时服务器进入 SYN_RECV 状态</p></li> <li><p>第三次握手：客户端收到服务器的 SYN+ACK 报文段。然后将 Acknowledgment Number 设置为 y+1，向服务器发送 ACK 报文段，这个报文段发送完毕以后，客户端和服务器端都进入 ESTABLISHED 状态，完成 TCP 三次握手。</p></li></ul> <hr> <h3 id="四次挥手断开连接"><a href="#四次挥手断开连接" class="header-anchor">#</a> 四次挥手断开连接</h3> <blockquote><p>TCP 协议是一种面向连接的、可靠的、基于字节流的运输层通信协议。<strong>TCP 是全双工模式</strong>，这就意味着，当主机 1 发出 FIN 报文段时，只是表示主机 1 已经没有数据要发送了，主机 1 告诉主机 2，它的数据已经全部发送完毕了；但是，这个时候主机 1 还是可以接受来自主机 2 的数据；当主机 2 返回 ACK 报文段时，表示它已经知道主机 1 没有数据发送了，但是主机 2 还是可以发送数据到主机 1 的；当主机 2 也发送了 FIN 报文段时，这个时候就表示主机 2 也没有数据要发送了，就会告诉主机 1，我也没有数据要发送了，之后彼此就会愉快的中断这次 TCP 连接。
FIN：关闭连接标识
SYN：建立新连接时，该位为 0
ACK：确认标识，连接建立成功后，总为 1
RST:复位标识，重建连接</p></blockquote> <ul><li><p>第一次分手：主机 1(可以是客户端，也可以是服务器端),设置了 Sequence Number 为 X，向主机 2 发送一个 FIN 报文段。此时主机 1 进入 FIN_WAIT_1 状态，表示主机 1 没有数据要发送给主机 2 了</p></li> <li><p>第二次分手：主机 2 收到了主机 1 发送的 FIN 报文段，向主机 1 回一个 ACK 报文段，ACK 为 Sequence Number+1，主机 1 进入 FIN_WAIT_2 状态，主机 2 告诉主机 1，我同意你的关闭请求</p></li> <li><p>第三次请求：主机 2 向主机 1 发送 FIN 报文段，请求关闭连接，同时主机 2 进入 LAST_ACK 状态；</p></li> <li><p>第四次请求：主机 1 收到主机 2 发送的 FIN 报文段，向主机 2 发送 ACK 报文段，然后主机 1 进入 TIME_WAIT 状态；主机 2 收到主机 1 的 ACK 报文段以后，就关闭连接；此时，主机 1 等待 2MSL 后依然没有收到回复，则证明 Server 端已正常关闭，那好，主机 1 也可以关闭连接了</p></li></ul> <hr> <h3 id="为什么要等待-2msl"><a href="#为什么要等待-2msl" class="header-anchor">#</a> 为什么要等待 2MSL</h3> <blockquote><p>MSL: 报文段最大生存时间，它是任何报文段被丢弃前在网络内的最长时间</p></blockquote> <ul><li>保证 TCP 协议的全双工连接能够可靠关闭</li> <li>保证这次连接的重复数据段从网络中消失</li></ul></div> <!----> <div class="content con-api"><!----> <!----></div> <div class="content page-nav"><p class="inner"><span class="prev"><a href="/blogs/team/js-style-guide.html" class="prev">
                    ←
                    Javascript风格指南
                </a></span> <span class="next"><a href="/blogs/project/performance.html">
                    前端性能优化
                    →
                </a></span></p></div> </div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blogs/assets/js/app.d6da1c5f.js" defer></script><script src="/blogs/assets/js/6.b1c09f51.js" defer></script><script src="/blogs/assets/js/1.f49fca97.js" defer></script><script src="/blogs/assets/js/17.96d30e1e.js" defer></script>
  </body>
</html>
